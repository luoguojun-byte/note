# 路由概述

## 路由

-  是指导报文转发的路径信息，通过路由可以确认转发IP报文的路径
- 路由设备是依据路由转发报文到目的网段的网络设备，最常见的路由设备是：路由器
- 路由设备维护着一张路由表，保持着路由信息
- 路由表的作用是指导数据报文逐条转发的

## 路由信息

- 目的网络：标识目的网段
- 掩码：与目的地址共同标识一个网段
- 出接口：数据包被路由转发到达目的网段的数据的接口
- 下一跳：路由器转发到达目的网段的数据包所使用的下一跳地址

## 路由表中各个内容的含义

-  Destination/Mask：表示此路由的目的网络地址与网络掩码
- Proto（Protocol）：改路由的协议类型，也就是路由器通过什么协议获知该路由的
- Pre（Preference）：表示此路由的路由协议优先级。针对同一目的，可能会存在不同下一跳，出接口。优先级最高
- Cost：路由开销。路由开销最小的将成为当前路由的最优的路由
- NextHop：表示对于本路由而言，到达该路由指定的目的网络的下一跳地址，指明了数据转发的下一跳设备
- Interface：表示此路由的出接口，指明数据从本路由的哪个接口转发出去
- 直连路由优先级（0）> OSPF优先级（10）> 静态路由优先级（60）> RIP优先级（100）

## 最长匹配原则

- 当收到一个数据包时，会将数据包的目的IP地址与本地路由表中的所有路由表项逐位比对，直到匹配度最长的条目。

##  静态路由&&缺省路由

- [Huawei]ip route-static （目的网段 ） （目的网段的子网掩码）（下一跳）
- 缺省路由在路由表的形式为0.0.0.0/0，缺省路由也被叫默认路由
  - [Huawei]ip route-static  0.0.0.0 0（下一跳）

# 动态路由

## 动态路由的分类

- 按工作区域来分
  - IGP（内部网关协议）
    - RIP
    - OSPF
    - IS-IS
  - EGP（外部网关协议）
    - BGP
- 按工作机制及算法分类
  - 距离矢量路由协议
    - RIP
  - 链路状态路由协议
    - OSPF
    - IS-IS

# 路由高级特征

## 等价路由

-  来源相同，开销相同的路由都会被加入路由表，形成的路由为等价路由（两个路由条目指向的目的网段相同，但是具有不同的下一跳地址）路由转发会将流量分布到多条路径上

## 浮动路由

- 和等价路由不同的是在两条等价路由设置不同的优先级来达到链路的备份，就是浮动路由

## CIDR（路由汇总）

- 把相同的前缀地址汇总成一个，从而达到减小路由表规模以及优化设备资源利用率的目的
- 汇总带来的问题：
  - 产生回环，在做路由汇总的范围太大了或者去往路由器没有该路由
    - 解决方案：[Huawei]ip route-static 10.1.0.0 16 NULL0，NULL是一个垃圾接口，如果匹配到这条就丢弃



## LoopBack 接口

- LoopBack接口属于设备上的逻辑接口，逻辑接口是指实现数据交换功能但物理上不存在，需要通过配置建立的接口
- 使用LoopBack接口一般有如下目的：
  - 作为路由器的管理地址，起到标识一台设备的作用
  - 使用该接口地址作为动态路由协议OSPF的 router id
  - 其他提高网络可靠性的用途

