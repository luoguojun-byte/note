# 网络可靠性

## 网络的可靠性

- 网络的可靠性指当设备或者链路出现单点或者多点故障时保证网络服务不间断能力
- 网络的可靠性可以从单板、设备、链路多个层面实现

#  链路聚合技术原理与配置

## 以太网链路聚合

- 以太网链路聚合Eth-Trunk，通过将多个物理接口捆绑在一个逻辑接口，达到提升带宽的目的

## 链路聚合基本术语/概念

- 聚合组
- 成员接口和成员链路
- 活动接口和活动链路（可以转发数据）
- 非活动接口和活动链路
- 聚合模式：手工模式和LACP模式
- 其他模式：活动接口上限阈值和下限阈值（规定有多少接口可以为活动接口）

## 链路聚合手工模式

- 设备老旧，低端，并不支持LACP协议
- Eth-Trunk的建立，成员接口均由手动配置，双方不参与LACP协议报文协商
- 当聚合的两端设备存在不支持LACP协议时，可以使用手工模式
- 正常链路都是活动链路，该模式所有活动链路都参与数据的转发，平均分担流量，如某线路故障链路聚合会自动平均分担流量

## 手工模式的缺陷

- 为了使链路聚合接口正常工作，必须保证接口所有成员的对端接口属于同一设备和加入同一链路聚合接口
- 手工模式下,设备没有报文交互，因此只能通过管理员人工确认
- 接口状态为UP但物理接口损坏，设备只能通过物理层状态判断对端接口是否正常工作

## LACPDU&&LACP

- LACPDU报文会携带设备优先级、MAC地址、接口优先级、端口号
- LACP模式：采用LACP协议的一种链路聚合模式，设备通过链路聚合控制协议数据单元（LACPDU）进行交互，通过协议协商确保对端设备是同一台设备，同一个聚合接口的成员
- 在LACP模式下，两端的设备的活动接口数目必须保持一致，否则无法建立，所以可以使其中一端成为主动端，另一端为被动端根据主动端选择活动接口
- 系统通过LACP优先级确定主动端，值越小优先级越高
- 接口LACP优先级值越小，优先级越高
- 如果优先级一样，那么就去选择对应的端口编号，越小越优

## 最大接口数量

- LACP支持配置最大接口数目，当成员接口数目超过最大活动接口数目就会比较优先级，接口号，选举出较优的接口成为活动接口，其余则成为备份端口，对应的链路成为活动链路，非活动链路，只有活动接口才能发生、接收报文

## 负载分担

- 基于包的负载分担
  - 可以实现没跟链路上流量一定是均衡的，微观来说速度会比较快，但是发出的时候可能是乱序的因为有延迟
- 基于流的负载分担
  - 数据流指的是你的数据从起点到终点，源和目的MAC地址、源和目的端口号、IP地址以及它的协议号这些信息都是一样的话那这些数据就属于数据流

## 基本配置命令介绍

- 
- 将接口加入到链路聚合组中：
  - [Huawei-Eth-Trunk 1]trunk interface-type {interface-number} 或者
  - [在接口里面]eth-trunk 1
- 允许不同速率的端口加入同一Eth-Trunk
  - mixed-rate link enable
- 配置系统LACP的优先级
  - [Huawei] lacp priority priority
- 
- 
- 
- 
- 配置端口LACP优先级
  - [Huawei-GigabitEtnernet0/0/1] lacp priority priority 只在接口已经加入到链路聚合中才能配置改命令
- 配置最大活动接口数
  - [Huawei-Eth-Trunk 1] max activate-linknumber {number}
  - 注：只有保持本端和对端的最大活动接口数一致，LACP支持最大活动接口数量

## 堆叠/集群概述



# 堆叠/集群概述

